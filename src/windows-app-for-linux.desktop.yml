app-id: com.microsoft.WindowsAppForLinux
runtime: org.freedesktop.Platform
runtime-version: '23.08'
sdk: org.freedesktop.Sdk
command: windows-app-for-linux
finish-args:
  - --share=ipc
  - --socket=wayland
  - --socket=x11
  - --socket=pulseaudio
  - --device=all
  - --share=network
  - --talk-name=org.freedesktop.Flatpak
  - --filesystem=home
  - --filesystem=xdg-documents
  - --filesystem=xdg-download

modules:
  - name: windows-app-for-linux
    buildsystem: simple
    build-commands:
      - |
        # Install Node.js from NodeSource
        curl -fsSL https://deb.nodesource.com/setup_20.x | bash -
        apt-get install -y nodejs
        
        # Install dependencies
        npm install --production
        
        # Create launcher script
        mkdir -p /app/bin
        cat > /app/bin/windows-app-for-linux << 'EOF'
        #!/bin/sh
        cd /app
        exec /usr/bin/node /app/node_modules/electron/cli.js /app/main.js "$@"
        EOF
        chmod +x /app/bin/windows-app-for-linux
        
        # Copy application files
        install -Dm644 main.js /app/main.js
        install -Dm644 package.json /app/package.json
        cp -r node_modules /app/
        
        # Install desktop file
        install -Dm644 windows-app-for-linux.desktop /app/share/applications/windows-app-for-linux.desktop
        
        # Install icon if it exists
        if [ -f windows-app-for-linux.desktop.png ]; then
          install -Dm644 windows-app-for-linux.desktop.png /app/share/icons/hicolor/512x512/apps/windows-app-for-linux.desktop.png
        fi
    sources:
      - type: dir
        path: .
